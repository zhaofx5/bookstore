毕业论文(设计)
题 目 校内二手物品交易网站
学生姓名 赵凤翔
学 号 20111334070
学 院 电子与信息工程学院
专 业 通信工程
指导教师 周华
二Ｏ一五 年 四月 十七 日目 录
1.选题背景...........................................................................................................................2
2.系统分析与设计 ................................................................................................................2
2.1 可行性分析................................................................................................................2
2.1.1 技术可行性 .........................................................................................................2
2.1.2 经济可行性 .........................................................................................................2
2.2 网站需求分析............................................................................................................3
3.数据库设计 .......................................................................................................................3
3.1 数据库设计原则 ........................................................................................................3
3.2 数据库设计步骤 ........................................................................................................4
3.3 网站后台支持数据库的部分表及部分建表 SQL 语句的展示......................................4
3.3.1 部分 SQL 语句......................................................................................................4
3.3.2 部分表格的展示..................................................................................................5
4.用户管理模块....................................................................................................................5
４.１用户注册.................................................................................................................5
4.2 用户登陆与注销 ........................................................................................................7
4.2.1 登陆功能.............................................................................................................7
4.2.2 注销 ....................................................................................................................8
5.二手物品交易板块.............................................................................................................8
5.1 首页展示 ...................................................................................................................8
5.2 二手物品发布..........................................................................................................10
5.3 管理员审核模块 ......................................................................................................12
5.4 天气预报模块..........................................................................................................13
6.图书购买板块..................................................................................................................13
6.1 图书展示界面..........................................................................................................13
6.2 图书管理界面..........................................................................................................14
6.3 编写购物车..............................................................................................................14
6.4 拦截器的引入..........................................................................................................156.5 订单支付 .................................................................................................................16
7.阿里云服务器的搭建 .......................................................................................................16
7.1 服务器的购买..........................................................................................................16
7.2TOMCAT 服务器的部署.............................................................................................17
7.3MYSQL 数据库的使用 ...............................................................................................18
7.3.1 数据库的登陆....................................................................................................18
7.3.2 数据库插入数据乱码问题的解决 ......................................................................18
7.3.3 使用工具访问数据库......................................................................................18
7.4 文件的上传..............................................................................................................19
7.5 网站的访问地址 ......................................................................................................20
８．总结与展望.................................................................................................................20
８.１工作总结...............................................................................................................20
８.２不足之处以及可以改进的地方..............................................................................20
参考文献…………………………………………………………………22
致谢………………………………………………………………………221
校内二手物品交易网站
赵凤翔
南京信息工程大学电子与信息工程学院， 南京 210044
摘要： 网站访问地址 http://115.28.137.186； 设计模式的话我严格遵循’ MVC’ 的设计模式，即
模型——视图——控制器的设计模式，不同的功能放在不同的结构中，增强代码的可读性，
复用性，减少开发者的工作量，提升网站的运行速度，同时为日后的网站维护工作减轻负担。
关键词： JAVA； STRUTS2； MYSQL 数据库； TOMCAT 服务器1
The campus second-hand goods trading site
Fengxiang Zhao
College of electronic and Information Engineering， NUIST， Nanjing 210044， China
， NUIST， Nanjing 210044， China
Abstract:Web site address http://115.28.137.186; Design pattern I follow
the 'MVC' designmode, namely the model view controller design , different functions on
different structure,enhance readability, code reuse, reduce the workload of developers, improve
speed andreduce the burden of the site, for the future website maintenance.
Key words： JAVA； STRUTS2； MYSQL Database； The TOMCAT Server2
1.选题背景
入学三年半， 我发现我们学校大四学生毕业的前一段时间都会有许多人出来摆摊，来理
自己大学四年积攒的一些自己不用的物品以及一些用过的图书。在我大三上了由高超老师主
讲的《JAVA 通信程序设计》课之后对 JAVA 语言产生了浓厚的兴趣， 我在学习了一段时间的
JAVA 语言之后就萌生了用 JAVA 语言来写一个校内的二手物品交易平台的想法，我这一想法
也得到了指导教师的大力支持， 大四的课程不是很繁重，我打算利用业余时间将这个网站搞
出来， 希望我所设计搭建的网站能为校内的同学们提供便利,同时可以让自己对于网站的搭建
有更深刻的理解，提高我自己的编程水平，也可以为毕业后找工作积累一定的基础和项目经
验。
2.系统分析与设计
2.1 可行性分析
2.1.1 技术可行性
通过一段的学习，搭建网站所要用到的 JAVA 编程技术，数据库 SQL 语言,在大学都有相
应的课程来学习，而一些开发页面的语言 JSP， HTML 等， 由于我的网站主题功能在后台，这
些我自学一些基本的知识就可以做一些简单的页面开发，综上所述，我认为我已经初步具备
了单独开发一个小型网站的能力。
工欲善其事必先利其器， 一个或者多个称手的开发者工具对于效率的提升是巨大的，称
手的或者说是优秀的开发工具可以大大的节省开发时间，换一种说法也就是提升了开发者的
效率， 比如减少代码的冗余，帮程序员做一些重复开发的工作，还有优秀的版本控制，帮开
发者封装好一些底层的公用的东西，所以在在进行网站开发之前还有一些准备工作是要做的。
首先服务器我选择是的 TOMCAT， TOMCAT 作为一个小型的轻量级的服务器深受一些小
型开发团体的喜爱，当然对于我这种以个人为单位的开发人员来说我认为是最适合不过的服
务器了。 TOMCAT 的自己的源码是开放的，如果在开发的过程中对于其运行原理有什么不明
白的地方可以直接查看其源代码，这对于还处在学习中的我来说是一件很好的事情。
开发工具我选择使用 MyEclipse， 据前辈介绍结合我自己的体验， 对于使用 JAVA 语言的
开发者来说 MyEclipse 是一个很强大的开发工具， 主要用于 Java、 Java EE 以及移动应用的开
发，它对于许多开源东西的支持非常优秀，再加上无数开发者为它定制了许多非常棒的插件，
这也是我选择 MyEclipse 的主要原因之一，比如说他的反编译插件，就可以让我在 myeclipse
中就方便的查看 jar 包中的*.class 格式的编译好的文件，这样可以节省不少的开发时间。
至于开发时调试页面所用的浏览器我选择兼容性很强的谷歌浏览器，而且它的开发者工
具是我所熟悉的，让我可以轻松的驾驭一些页面的调试，当网站基本开发完成后，我会再做
一些浏览器的兼容性的调整的。
2.1.2 经济可行性
在我分别使用了百度云服务器和阿里云服务器之后，我选择将项目搭建在阿里集团的云
服务器之上，虽然阿里云的收费可能比百度云更高一些，但是它给开发者的自由度更高，更
方便， 我算了一下网站初期用它的最低配置的话大概是五十元一个月，我自己完全可以从零
花钱中把这一部分钱省出来。 当网站的人流量有了一定的规模之后就可以和一些广告商合作
来维持网站的正常运营和维护，到最后的盈利，在论文的最后有我自己在阿里云上搭建项目
的一些新的以及一些注意事项。3
2.2 网站需求分析
去做一个网站最重要的事情是心中要先有一个想法网站要做成什么样子的，然后就是网
站做成这样会有用户喜欢吗，网站用户的真正需求是什么， 基于这些在开发之前最好可以写
一个需求文档，将网站所需要包含的功能全部罗列出来，当这些都明确的时候才可以进行开
发，如果这些在开发之前都不是很明确那么自己开发工作很可能会成为无用功,并且在以后的
维护的时候也极为麻烦。 任何一个别人认为效率很高的的团队在开发之前必须会将需求清晰
的掌握。 如果一个开发团队对于需求不明确，那么之后他要面临的就是不断地更改自己所开
发的东西，做很多重复的事情和无用功，这个系统要实现什么样的功能，有什么约束条件，
会有什么样的特征行为和属性，，这些都是开发者对于明确需求的要求。在这种情况下，如果
开发者有一份优秀的需求文档，那么就会缩短整个开发周期，提升开发效率。
在经过详细的考虑以及结合我自身的能力，我认为我的二手物品网站应该包含如下的功
能：
首页导航功能： 拜候网站的用户会经由过程首页的一个导航功能来更好的利用本网站。
网站新闻发布功能： 揭示一些校内的消息，网站的最新消息，和一些政策动态。
网站介绍： 简单的简绍一下自己的网站，算是一个使用手册，对用户使用改网站进行简
单的指导。
用户在线留言： 这个功能对于网站的改进有着重要的作用，它可以让开发者了解用户的
心里，对于网站的建议要求，开发者可以根据这些建议对网站的功能做出升级改造。
新用户注册：在网站如果有二手物品以及给我们留言的需求那么就必须进行一个用户的
注册。
商品展示： 商品的展示主要是二手图书的功能，不排除后期添加更多物品的可能性。
网站超级管理员： 有二手物品的审核权限，有阅读和回复站内信的权限，有二手图书的
增加，修改价格封面以及删除的权限，还有普通用户普通管理员的添加。
’MVC’的设计模式是好多开发者挂在嘴边的一种设计模式，但是在开发的过程中没必要非
常严格的遵守这种设计模式，然是在这种设计模式大的框架之下做出符合自己需求的相应变
动， 这种模型——视图——控制器的设计模式还是对于功能的分层有着显著的提升的，不同
的功能放在不同的结构中，增强代码的可读性，复用性，减少开发者的工作量， 而且非常符
合开发者的一个逻辑， 以后如果对于网站的功能进行改进的话，这样设计比较方便原始开发
者或者是后来接手的开发者进行操作。
3.数据库设计
3.1 数据库设计原则
1.现实中存在的实体一定要在数据库的表中体现出来，而且最重要的是实体和库要保持一
对一的关系，比如说网站的主要实体二手物品，在数据库中就一定要有这个表的存在，而且
这个表中不可以有一些不是二手物品的字段和属性， 这就是数据库设计中首要的一对一关系，
只有在一些非常特殊的情景下，才允许出现一些一个对应多个或者是多个对应多个的关系。
2.还有就是关于要不要主键的问题，以及主键到底有多重要，比如说我的用户表就必须要
有个用户 ID 来做主键，来标识用户的唯一性，没有这个主键的话就无法将一些名字相同的用
户标识开来，虽然前段会有一个用户名是否相同的校验，但是这个主键还是必须存在的，那
个校验只是前端的一个保证，后台的数据库还必要要有数据库可以区别的方式。
3.基本表所具有的一些特性。 若是表中的一些字段还可以举行再分化，那末这张表就不能4
称之为根基表，我计划的这些数据表记实的若是一些最原始的数据，一些最根本的数据，虽
然是一些根基的数据，可是要能按照这些根基的数据获得其他全部的拨开获得的数据，辨别
根基表和非根基表也是数据库个一项主要原则。
4. 根基表与字段在数据库当中的干系是要知足必然前提的，便是凡是所说的范式。
5.主键在建立的过程中最好使用系统自加一的方法， 就是建立一个序列来对主键进行自增，
使用其他有意义的字段时最好将字段保持在一定的字数之内，不宜太长。
7.要注意消除冗余的字段，但是如果主键和外键多次的出现不能看做是冗余的字段。
3.2 数据库设计步骤
1. 需求分析阶段，在这个阶段要领会用户对数据的一些请求，包罗对平安，处置和完全
性请求。
2. 第二步是计划数据的概念模型，如果技术条件能达到的话最好画出一个表的概念模型
图。
3. 第三步是关于数据库的逻辑布局的计划，需要花个一个表之间的关系图来表明这些表
之间存在的逻辑关系。
4. 第四步计划便是数据库的硬件布局了。
5. 第五步就起头存数据入库，举行调试和运行。
6. 最后就是对一些后期需求的增加的预见，表的设计要存在合理的可塑性，还有就是要
考虑到数据的维护成本，包括多余的表结构，多余的数据的删除，数据库内存的处理（包括
清除无用的内存） 等方面。
3.3 网站后台支持数据库的部分表及部分建表 SQL 语句的展示
3.3.1 部分 SQL 语句
用户表建表语句：
CREATE TABLE `user` (
`USERNAME` VARCHAR(50) NOT NULL PRIMARY KEY,
`PASSWORD` VARCHAR(50) DEFAULT NULL,
`FILENAME` VARCHAR(50) DEFAULT NULL,
`STATE` INT(11) DEFAULT NULL
) ENGINE=INNODB DEFAULT CHARSET=utf8
书籍表：
CREATE TABLE `book` (
`BOOKID` int(11) DEFAULT NULL,
`TITLE` varchar(50) DEFAULT NULL,
`PIC` varchar(50) DEFAULT NULL,
`AUTHOR` varchar(50) DEFAULT NULL,
`PRICE` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
管理员：
CREATE TABLE `admin_user` (
`NAME` varchar(50) DEFAULT NULL,
`PASSWORD` varchar(50) DEFAULT NULL5
) ENGINE=InnoDB DEFAULT CHARSET=utf8
货物保存表
CREATE TABLE `goods` (
`GOODSNAME` varchar(50) DEFAULT NULL,
`DETAIL` varchar(200) DEFAULT NULL,
`PRICE` varchar(50) DEFAULT NULL,
`PIC` varchar(50) DEFAULT NULL,
`SELLERNAME` varchar(50) DEFAULT NULL,
`TEL` varchar(50) DEFAULT NULL,
`STATE` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
3.3.2 部分表格的展示
3.3.2.A 图书表
3.3.2.B 用户表
3.3.2.C 货物保存表
4.用户管理模块
４.１用户注册
作为一个交易网站，用户的注册时非常重要的一环，物品的的购买交易，站内信等功能
都需要一个明确的用户支持。特别是在二手图书购买会有注册用户的要求，不然会被拦截器
拦截无法进行加入购物车并且结算的操作，所以我的网站首先添加的就是用户的注册功能。
在点击注册按钮之后会弹出注册界面：6
4.1.A 注册界面
在填写用户名密码并上传头像之后就可以点击注册了，其中头像图片的名字在服务器进
行了重新的命名来避免重复冲突。 然后在后台我首先会通过下面的代码来判断用户是否被注
册：
public String makeSureUser(String username) throws SQLException
{
//首先通过 SQL 语句在后台查询
String sql ="select * from users where username = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, username);
ResultSet rs = ps.executeQuery();
if(rs.next())
{
String un = rs.getString("username");
return un;
}
return null;
}
public String saveUser(User user) throws SQLException
{
//先查看用户名是否被使用
String un = user.getUsername();
String username = makeSureUser(un);
//在这里进行一个比较，如果相同的话就表示用户名已经被注册，就需要返回给
用户一个用户名被占用的信息
if(username.equals(un)){
return null;
}else{
//如果用户名没有被注册通过 INSERT 语句将用户名插入数据库
String sql = "insert into users(username,password,filename) values(?,?,?)";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, user.getUsername());
ps.setString(2, user.getPassword());
ps.setString(3, user.getFilename());
ps.execute();
return "SUCCESS";7
}
}
代码简介：首先写一个 makeSureUser（）方法来通过后台传来的要注册的用户名进行查
询，返回查到的用户名。然后通过 saveUser(User user)方法调用 makeSureUser（）方法，通过
比较页面传来的用户名和后台查到的用户名可以判断用户是否被注册了，如果用户被注册了
就返回一个空的值并且跳转到如下的界面：
4.1.B 报错信息
可以通过点击注册新的账号来重新注册，如果第二次注册成功了就会弹出下方的页面：
4.1.C 用户注册成功提示界面
4.2 用户登陆与注销
4.2.1 登陆功能
当用户注册成功之后就需要用登录的功能，下图网站的登录界面：
4.2.1.A 用户登陆界面
在点击登录之后会通过如下的代码到后台验证：
//下面俩行代码是用来获取前台页面的 SESSION 值的
HttpServletRequest request = ServletActionContext.getRequest();
HttpSession session = request.getSession();
//通过 RERQUEST 对象获取用页面传来的户名和密码
String username = request.getParameter("username");
String password = request.getParameter("password");
User user = new User(username,password);
首先通过 REQUEST 请求从前台取到数据，然后存入 USER 对象中。
String sql ="select * from users where username = ? and password = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, username);
ps.setString(2, password);8
ResultSet rs = ps.executeQuery();
if(rs.next()){
User user = new User(username,password,rs.getString("filename"),rs.getInt("state"));
return user;
}
return null;
然后通过 JDBC 连接到数据库进行用户的验证，登陆成功之后会在前台展现用户的登陆信
息。
4.2.1.B 用户登陆信息
4.2.2 注销
登陆成功的用户还可以选择注销自己的用户来对， 由于用户的登陆信息是存在浏览器的
额缓存当中的，所以注销用户实质上就是将用户信息从缓存中清除，实现代码如下：
<%
session.invalidate();
request.getRequestDispatcher("/logoutPage.jsp").forward(request,response);
%>
通过 session.invalidate();清除用户信息之后再跳转到网站的首页，用户可以选择继续浏览
网站，或是重新登陆或是直接退出。
5.二手物品交易板块
5.1 首页展示
作为网站的核心模块，二手物品交易我在设计的过程中是倾注了不少心血的，首先是二
手物品的一个展示区域，其次还用一个管理员登陆和审核的功能，因为二手物品不可能已发
布就可以直接展示在网站的交易区，总要有一个中间审核的过程来对物品进行把控，这样可
以对网站进行一个把控，避免一些用户的恶意使用和竞争，虽然说网站对于一些黑客或是技
术大牛来说漏洞很多，但是我会在我的能力范围之内把网站的安全防护做到最好， 这是对我
的网站的一种保护， 也是对同学们的一种负责。
在首页的上方是二手物品的发布入口和审核入口，下方是二手物品的展示区域。物品查
询通过原始的 JABC 方法查询，因为我认为使用 JDBC 方式链接数据库的速度是很快的，现在
流行的一些框架封装好的方法里面就起核心来说也是 JDBC 所以我认为我没有必要为了链接
数据库而再搭建一个 HIBERNATE 或是一个其他的可以链接数据库的框架，下面是查询代码：
public List<Goods> queryGoods() throws SQLException
{
String sql ="select * from bookstore.`goods` ";
PreparedStatement ps = conn.prepareStatement(sql);
ResultSet rs = ps.executeQuery();
List<Goods> goods = new ArrayList<Goods>();
Goods good = null;9
//获取查询对象之后，通过 WHILE 循环将物品信息全部取出
while(rs.next())
{
String GOODSNAME = rs.getString("GOODSNAME");
String DETAIL = rs.getString("DETAIL");
String PRICE = rs.getString("PRICE");
String PIC = rs.getString("PIC");
String SELLERNAME = rs.getString("SELLERNAME");
String TEL = rs.getString("TEL");
int STATE = rs.getInt("STATE");
//这边有个判断，只有状态为 1 表示是经过审核的物品才会展示出来
if(STATE == 1){
good = new Goods(GOODSNAME, DETAIL, PRICE, PIC, SELLERNAME,
TEL, STATE);
//物品信息全部取出之后存入 goods 数组之中
goods.add(good);}
else{
System.out.print("这个物品不予展示");
}
}
代码介绍：首先通过 SQL 语句将货物表的所有内容查出，然后通过 IF 语句判
断二手物品的状态 STATE，最后将所有状态为１的二手物品保存起来发送到前端
页面，在这里特别说明一下货物表的 STATE 字段是一个非常重要的字段，后台会
根据这个字段的值来对数据进行相应的操作。
状态为一说明是审核通过的物品，而不是一的则表示是未经过审核的物品，是
不可以展示在网站首页的。
前端页面的物品展示通过<c:forEach>标签展示，这个标签实质上也是一种封装好的 FOR
循环，弄明白各个参数的作用就可以直接拿来用了，下方是标签的代码：
<c:forEach items="${requestScope.goods}" var="good">
<div class="lstGood">
<span class="txt1">物品名称☆${good.GOODSNAME}</span><hr/>
<span class="txt1">详细描述☆${good.DETAIL}</span><hr/>
<span class="txt1">价位☆${good.PRICE}</span><hr/>
<span class="txt1">卖家☆${good.SELLERNAME}</span><hr/>
<span class="txt1">卖家电话☆${good.TEL}</span><hr/>
<img class="lstpic" src="upLoad/${good.PIC}" height="200" width="200"/>
</div>
</c:forEach>
在后台传来一个包含所有二手物品的对象之后，通过循环一个个把这些对象展现出来。10
5.1.A 二手物品首页样式
当鼠标悬浮在图片上方的时候就会有物品的详细信息展现出来， 这个其实是每个物品下
面都有一个隐藏的 DIV，页面加载的时候这个 DIV 区域是隐藏的，当鼠标悬浮上去的时候这
个 DIV 区域就会显示出来，当鼠标移开的时候这个区域就会再次隐藏起来，效果图如下：
5.1.B 物品的详细信息展示
5.2 二手物品发布
网站展示的物品是依靠同学们自己发布上来的，所以网站还得有一个二手物品的发布功
能， 这也是网站的一个核心功能，如何把网站的发布界面做的高效，和用户的交互度高，让11
用户用着舒服，这也是建设该网站的一个重大挑战。
点击发布二手物品交易信息的按钮之后就会进入如下图所示的发布界面：
5.2.A 二手物品发布界面
在点击发布之后就会将数据带到后台进行处理和保存。
这行是用来上传实物图片的代码：
String path = ServletActionContext.getServletContext().getRealPath("upLoad");
为了保存方便所有的实物图在后台都通过如下的代码进行了重新的命名：
//调用 Math.random 随机生成百万位的随机数，很大程度的避免了图片名称的重复
String filename = (int)(Math.random()*1000000)+".jpg";
File desk = new File(path+"/"+filename);
try {
FileUtil.copyFile(upLoad, desk);
} catch (IOException e) {
// TODO Auto-generated catch block
e.printStackTrace();
}
通过上面的代码保存在服务器和数据库的图片名就被重新命名了。
然后通过下方 REQUEST 取到前台传过来的用户发布的各项数据。
HttpServletRequest request = ServletActionContext.getRequest();
String GOODSNAME = request.getParameter("GOODSNAME");
之后调用写好的保存方法将数据保存到数据库当中。
物品发布成功之后会有如下的弹出框提示用户二手物品发布成功以及需要等待的信息：
5.2.B 发布成功信息12
5.3 管理员审核模块
我会在后台创建一个管理员的账号对大家发布的二手物品进行审核，只有审核通过的物
品才能在首页进行展示。
5.3.A 管理员登陆界面
在输入正确的用户名密码登陆之后，网页会展示出那些状态为 0 的待审核的物品。每个
二手物品下都有审核通过与不通过俩个按钮，如果审核通过的话会通过如下的代码将物品的
状态ＳＴＡＴＥ值改为１，代码如下：
由于从前台传过来的有好多中文字符，所以我需要下面的代码来对其重新编码用以解决
乱码问题：
byte b[] = SELLERNAME.getBytes("iso8859-1");
SELLERNAME = new String(b,"utf-8");
从前台传来的字符是通过 iso8859-1 方式来编码的，所以首先我要将它先转成字节然后进
行 utf-8 重新的编码。
５.3.B 二手物品审核界面
点击审核通过的按钮我会通过如下的代码将物品的状态ＳＴＡＴＥ修改为１，并且重新
加载该页面，保证审核过的物品不会继续留在审核界面。
String sql ="UPDATE bookstore.`tb_goods` SET STATE = '1' WHERE SELLERNAME = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, SELLERNAME);
ps.execute();
上面就是修改物品状态的关键代码。
点击审核不通过我会调取后台的方法将此物品从数据库删除，同样的会刷新一下界面用
来保证审核界面的所有物品都是未审核过的。13
5.4 天气预报模块
现阶段天气预报板块基本上每一个网站都会有，所以我也在我的网站首页腾出一块地方
来进行天气预报的展示，我天气预报的数据是通过在聚合数据上注册申请得到的，聚合数据
网站会给我一个接口，我每次发起请求的时候它都会给我返回一个封装好七天内天气预报信
息的对象，然后我通过 JSON.stringify()这个方法将对象变成字符穿就可以使用了，最后我把数
据放在一个表格里面进行首页展示，效果图如下：
5.4.A 天气预报展示
6.图书购买板块
6.1 图书展示界面
6.1.A
在我点击了二手图书的购买按钮之后就会进入二手图书的售卖界面，这个按钮的链接地
址是一个 ACTION，通过这个按钮我会去数据库查询数据，再通过后台的处理之后将待售卖
的图书信息展现在前台的页面，下面是网站截图：
6.1.B 二手图书购买首页
如果买家对图书有兴趣可以通过点击图书封面图片来了解一下图书的详情，如下图所示：14
6.1.C 书籍详情
6.2 图书管理界面
图书管理的功能包括了对图书的上架，下架的管理，价格的修改，库存量的修改，这个
管理的工作也是通过我后台添加一个管理员来进行管理的。由于这个管理员的权限非常大，
所以管理员账号的添加工作是要经过严格的审核工作的。
6.3 编写购物车
当浏览网站的人对图书感兴趣的时候就可以选择将图书加入购物车，点击加入购物车。
购物车会将这些书籍信息存储起来，如下图所示：
6.3.A 购物车
由于购物需要保存的字段信息较多，所以当初我设计购物车的时候添加了比实际上展示
出来信息还要多的字段用来防止需求的变更，首先购物车需要有一个 ID，其次是书籍的名称，
数量，价格，以及买家的信息。购物车的核心代码如下;
// 如果购物车为空
List<CartItem> cart = (List<CartItem>) session.getAttribute("cart");
if (cart == null) {
// 创建一个购物车的篮子
cart = new ArrayList<CartItem>();
// 构建CartItem
CartItem item = new CartItem(book.getBookid(), book, 1);
cart.add(item);15
} else {
// 购物车里面已经有一个相同的书
/ true表示没有相同的
boolean flag = true;
for (CartItem item : cart) {
if (item.getId() == id) {
flag = false;
item.setCount(item.getCount() + 1);
break;
}
}
if (flag) {
// 没有相同的项
CartItem item = new CartItem(book.getBookid(), book, 1);
cart.add(item);
} }
代码首先从 session 中去取购物车对象，如果发现购物车对象是空，责需要新建一个购物
车，如果不为空，在判断需要加入购物车的书籍是否已经存在于购物车中，如果不存在，则
新建书籍对象，如果已经存在相同的书籍则只需要将之前的书籍数量加一。
6.4 拦截器的引入
拦截器的引入主要是用来判断用户是否已经登陆，比如网站的查看购物车功能就需要用
户登陆才能去将书籍加入以及去查看购物车，拦截器我使用的是上 struts2 的拦截器，在
struts.xml 中加入
<interceptors>
<interceptor name="iaddcart" class="com.study.interceptor.AddCartInterceptor"></interceptor>
然后再自己需要拦击的请求面前加上
<interceptor-ref name="iaddcart"></interceptor-ref>
就可以实现对服务请求的拦截目的了。拦截器服务类是要实现 INTERCEPTOR 接口的，然
后在如下的方法中配置需要验证拦截的项目。
public String intercept(ActionInvocation arg0) throws Exception {
// TODO Auto-generated method stub
HttpServletRequest request = ServletActionContext.getRequest();
HttpSession session = request.getSession();
//从缓存中取 USER 对象
User user = (User) session.getAttribute("user");
String result;
//如果 USER 对象为空就要进行拦截，发送信息自动跳转到登陆页面
if(user == null){
return "LOGIN";
}else{
//不为空的话请求就可以继续
result = arg0.invoke();
}
return result;
}16
在上面的代码中我验证的是 session 有没有 user 对象，如果不存在 user 对象的话这个请求就要
被拦截下来，存在 user 对象的话请求就可以通过。
6.5 订单支付
用户如果不打算继续购买图书的话就可以选择将购物车里的东西生成订单，然后链接到
支付页面进行支付。
7.阿里云服务器的搭建
网站代码写好测试结束之后就需要发布到服务器上供大家访问，这时候我想到了阿里集
团推出的阿里云，由于阿里云前半年是免费的，对于还在读书的我是一个很好的消息，可以
节省一大笔的租用服务器的费用。
7.1 服务器的购买
进入如下的阿里云购买界面
7.A 阿里云服务器购买界面
然后可以从镜像市场选择一个别人已经做好的镜像系统来安装
７.Ｂ 选择镜像系统
在这里我选择的是一个 UBUNTU 系统，里面安装的服务器是 TOMCAT7.0，数据库是
MYSQL， JDK 版本是 1.7.0。
点击立即购买，等待服务器配置成功17
７.Ｃ 服务器实例图
当生成一个如上图所示的实例图之后就表示服务器配置成功了，然后我使用 PUTTY 这个
工具来对服务器进行访问。
7.D 服务器登陆
7.2TOMCAT 服务器的部署
输入正确的用户名与密码之后就会看到服务器已经登陆成功，输入命令
ps -ef | grep tomcat
就会发现 TOMCAT 服务器并没有启动，输入命令
cd /alidata/server/tomcat7/bin
sh startup.sh
然后就会发现ｔｏｍｃａｔ服务器已经启动好了
７.Ｅ ｔｏｍｃａｔ服务的启动
然后将 TOMCAT 的端口号改为 80 通过修改 server.xml 文件里的 port="8080" 改为 port="80"18
7.3MYSQL 数据库的使用
7.3.1 数据库的登陆
首先还是启动数据库，通过如下的命令：
/etc/init.d/mysqld start
然后使用 ROOT 用户登陆，命令如下
/alidata/server/mysql/bin/mysql -uroot -p1389c21ad3
7.3.2 数据库插入数据乱码问题的解决
通过 show databases use test 可以使用到ｔｅｓｔ数据库
当输入中文字符再查询的时候会发现中文字符显示的都是问号，如下图
select * from TB_BOOK ;
７.Ｆ 显示乱码的数据库截图
导致这一个原因的是数据库的编码问题， 可以执行下面的ＳＱＬ将数据库的编码规则改变：
SET character_set_client = 'utf8';
SET character_set_connection = 'utf8';
SET character_set_results = 'utf8';
展示 musql 编码规则：
７.Ｇ 查看数据库的编码
看上图就会发现数据库的编码规则已经都变成了ｕｔｆ－８，乱码问题已经得到了解决。
7.3.3 使用工具访问数据库
为了更方便的使用数据库，我会用 SQLYOG 数据库连接工具来对数据库进行链接：19
７.Ｈ sqlyog 链接界面
由于是其他主机对服务器里数据库的访问，所以还有一个数据库用户权限的问题， ROOT
并不能在非本地的主机上登陆，所有就需要创建一个有外部访问权限的数据库用户，我通过
以下代码创建了一个超级管理员
grant all on *.* to book@"%" Identified by "xiao917";
有了这个用户就可以在其他主机上访问服务器上的数据库了。
７.Ｉ 外部登陆成功
7.4 文件的上传
服务器布置成功之后就需要把编译后的代码发布到服务器上，我使用的上传工具是
FILLZALLA， FTP 用户名密码服务器都有提供，端口号填写２２，就可以开始上传文件了。20
７.Ｊ FTP 连接成功
7.5 网站的访问地址
下面是我发布在阿里云服务器上的网站访问地址， 因为暂时还没有为我的网站购买域名，
所以暂时只能使用 IP 地址进行访问了， 这个地址在 2015 年 9 月之前都有效，之后就需要为阿
里云服务器续费了。
http://115.28.137.186
８．总结与展望
８.１工作总结
这个网站的设计我完成了普通用户的登陆，注册功能，以及管理员的登陆管理功能，二
手物品的发布功能，图书购买功能，以及拦截器的引入，总体上完成我设定的预期目标，在
开发这个网站的过程中，我对于 JAVA 语言的理解，已经数据库的设计使用，服务器的搭建都
提升到了一个新的水平，希望我的网站可以如期的开始使用，为学校同学们提供便利。
８.２不足之处以及可以改进的地方
接下来网站需要进一步改善的地方有：
(1) 丰富系统功能。
1. 在注册用户的时候要有用户名格式的限制，就是说要使用正则表达式添加规则集，对
用户名的格式做一个统一的限制。
2. 对密码格式的要求。
3. 密码的修改功能还没有添加。
4. 用户信息的查看和修改功能没有添加。
5. 在登陆的时候要添加验证码进行验证， 验证码的功能没有添加。
6. 后期可以对二手物品进行一个分类的处理， 现在物品还没有做一个系统的分类处理。
7. 一些界面的美化等等。21
总之目前系统设计的仅仅是一些基本功能， 可以进一步研发具备个性特征的智能化
功效，为全校师生员工供给更多的便当，更好的办事。
(2) 还可以优化程序代码。由于时间的原因，本人所编写的程序代码可能有很多的冗余，
低效率的地方，以后还需要我对代码， 对系统进行优化，以便提高系统的性能。
(3) 网站的安全是一个非常重要的方面，本网站在刚放到服务器上的时候就被我的一个
同学黑掉了，这件事情给了很大的警醒，我打算把以后的很大一部分精力放在网站
的安全维护上面。他黑我的网站是通过我的物品发布功能，上传代码到我的数据库
中：
<script src="http://121.42.155.73/res-images/FSLKFfsklf.js"></script>
这样的一段字符串到我数据中，然后我在管理界面读取这一字段的时候，由于该字
段是可以直接在 HTML 执行的脚本，导致页面执行了他放在另外一台服务器上的脚
本，结果的我的管理界面变成如下图所示的样子了：
8.A 网站被黑之后的样子
这个漏洞是我没有进行字符串的规则校验导致的，我相信我的网站其它的漏洞也不会少，
这方面的欠缺我一定要加紧弥补。22
参考文献：
[1]一林. Java 网络编程实例[M]. 清华大学出版社, 2003.
[2]Edwards J, 爱德华兹, Adams C, et al. JavaScript 精粹[M]. 人民邮电出版社, 2007.
[3]Oracle 数据库基础教程[M]. 人民邮电出版社, 2008.
[4]Cooper J W, 科珀, 宇, 等. Java 设计模式[M]. 中国电力出版社, 2003.
[5]文渊, 惠贞, 俊荣. ASP 与网页数据库设计[M]. 中国铁道出版社, 2001.
[6]Dean D, Felten E W, Wallach D S. Java security: from HotJava to Netscape and beyond[C]. //IEEE
Symposium on Security and Privacy. IEEE, 1996:190 - 200.
[7]Chen F, Roşu G. Java-MOP: A Monitoring Oriented Programming Environment for Java[J]. Lecture Notes
in Computer Science, 2005:546-550.
[8]Havelund K, Pressburger T. Model checking JAVA programs using JAVA PathFinder[J]. International
Journal on Software Tools for Technology Transfer, 2000, 2(4):366-381.
[8]Boyapati C, Rinard M. A Parameterized Type System for Race-Free Java Programs[J]. ACM
CONFERENCE ON OBJECT-ORIENTED PROGRAMMING, SYSTEMS, LANGUAGES AND
APPLICATIONS (OOPSLA), OCTOBER 2001, 2001, 36(11):56-69.
[9]Berg J V D, Jacobs B. The loop Compiler for Java and JML[J]. Lecture Notes in Computer Science,
2000:299--312.
[10]Malabarba S, Pandey R, Gragg J, et al. Runtime Support for Type-Safe Dynamic Java Classes[J].
Fourteenth European Conference on Object-oriented Programming, 2000:337--361.
[11]Chiba S, Nishizawa M. An Easy-to-Use Toolkit for Efficient Java Bytecode Translators[J]. Lecture Notes
in Computer Science, 2003:364--376.
[12]Stoller S D. Model-checking multi-threaded distributed Java programs[J]. International Journal on Software
Tools for Technology Transfer, 2002, 4:71-91. DOI:10.1007/10722468_14.
[13]Adi-Tabatabai A, Cierniak M, Lueh G, et al. Fast, effective code generation in a just-in-time Java
compiler[C]. //Proc. of 1998 ACM SIGPLAN Conference on Programming Language Design and
Implementation (PLDI. 1998:280-290.23
致谢
毕业设计的工作已经接近了尾声，我大学四年的生活也接近了尾声，在这里我要对许多
给予我帮助的人表示感谢，是在你们的帮助下我才能顺利的完成这篇毕业设计。
首先，我认为我最应该感谢的是我的论文指导老师周华老师。 做毕业设计是大学四年中
一件比较艰辛的事情，因为它意味着你要把自己的大学四年所学的东西融会贯通在自己所做
的毕业设计中，我需要加倍的努力才能完成这件事情。在这个过程中周华老师给了我很大的
帮助，他给我细心，耐心的知道让我度过了很多的难关，有时候碰到无法解决的难题，总是
周华老师让我拨云见雾，顺利的将问题解决。 老师们平时的科研任务也是很繁重的， 但是自
从知道教师分配完成之后，周华老师总是在网上给我知道或者是把我喊到他的办公室进行详
细的问询和指导， 写毕业论文的每个阶段周华周老师都给我了很大的帮助， 不论是选题开题，
论文的编写， 最后详细的格式排版，周华老师都给了我很大的帮助， 作为一个德高望重的老
师周华老师不仅学术造诣精湛而且师德高尚，在我的毕业论文编写期间，秉承着授人以渔的
观点，周老师给我亲身讲解了许多学习和修身的方法， 所以在此我一定要向周老师表达我最
真挚的谢意。
其次， 大学四年给我上课的各位老师们，你们也功不可没，没有你们的谆谆教导，我也
不可能顺利的完成这篇毕业论文。
最后， 我要向所有帮助过我的同学朋友们说声谢谢，在你们的帮助下我才客服了众多的
难关一步步的走下去。
这次的毕业设计让我重新的锤炼了自己所掌握的知识，然后把他们系统的运用出来，对
我个人的提升是巨大的，写论文是一个学习的过程，同时论文的完成也意味着一个新的生活
的开始，让我们在新的生活中继续追逐当初的梦想，为了我们的未来，加油！24
